# Migration Guide: v1 ‚Üí v2

## Overview

NmapAIGility v2.0 is a **major rewrite** with significant architectural improvements. While most CLI options remain similar, there are important changes and new features.

## What's Changed

### ‚úÖ **Backward Compatible**
These work the same in both versions:
- `-f, --file` - Target file
- `-n, --nmap` - Nmap parameters
- `-o, --out-dir` ‚Üí `-o, --output` - Output directory
- `-t, --threads` - Nikto threads
- `-K, --no-nikto` - Disable Nikto
- `-a, --ai` - Enable AI
- `-m, --model` - AI model
- DursVuln options (`-D, -G, -L, -P, -S, -O, -U`)

### üÜï **New Features**
- `--profile` - Scan profiles (quick, standard, deep, stealth)
- `--config` - YAML/JSON configuration files
- `--ai-provider` - Multi-model support (openai, anthropic, ollama)
- `--ai-stream` - Real-time streaming responses
- `--no-nvd, --no-epss, --no-exploitdb` - Control enrichment
- `--nvd-api-key` - Faster NVD rate limits
- `--report-formats` - Choose output formats
- `--adaptive` - Intelligent follow-up scanning
- `--list-profiles` - Show available profiles

### ‚ö†Ô∏è **Breaking Changes**
1. **Script name:** `nmapai.py` ‚Üí `nmapai_v2.py`
2. **Output directory:** `out_nmapai_*` ‚Üí `out_nmapai_v2_*`
3. **Enrichment:** Now ON by default (can disable with `--no-*`)
4. **AI providers:** Must specify with `--ai-provider`
5. **Reports:** Multiple formats generated by default

## Side-by-Side Comparison

### v1 Command:
```bash
python nmapai.py \
  -f targets.txt \
  -n "-sV -T4 --top-ports 1000" \
  -o scan_results \
  -a \
  -m gpt-4o-mini \
  -D -G -U
```

### v2 Equivalent:
```bash
python nmapai_v2.py \
  -f targets.txt \
  --profile standard \
  -o scan_results \
  --ai \
  --ai-provider openai \
  -m gpt-4o-mini \
  -D -G -U
```

### v2 (Simplified with Profile):
```bash
python nmapai_v2.py -f targets.txt --profile standard --ai
```

## Migration Steps

### Step 1: Install v2 Dependencies

```bash
# v2 requires additional packages
pip install -r requirements.txt

# Or upgrade existing installation
pip install --upgrade rich aiohttp pyyaml
```

### Step 2: Test v2 Alongside v1

Both versions can coexist:

```bash
# v1 still works
python nmapai.py -f targets.txt -n "-sV" -a

# v2 uses new script
python nmapai_v2.py -f targets.txt --profile quick --ai
```

### Step 3: Convert Your Workflow

**Scenario 1: Basic Nmap Scan**

v1:
```bash
python nmapai.py -f targets.txt -n "-sV -T4"
```

v2:
```bash
python nmapai_v2.py -f targets.txt --profile quick
# or
python nmapai_v2.py -f targets.txt -n "-sV -T4"
```

**Scenario 2: Full Scan with AI**

v1:
```bash
export OPENAI_API_KEY="sk-..."
python nmapai.py -f targets.txt -n "-sV -sC -T4" -a -m gpt-4o-mini
```

v2:
```bash
export OPENAI_API_KEY="sk-..."
python nmapai_v2.py -f targets.txt --profile standard --ai
```

**Scenario 3: DursVuln Integration**

v1:
```bash
python nmapai.py -f targets.txt -n "-sV" -D -G -U -S HIGH
```

v2 (same):
```bash
python nmapai_v2.py -f targets.txt -D -G -U -S HIGH
```

**Scenario 4: Stealth Scan**

v1:
```bash
python nmapai.py -f targets.txt -n "-sS -T2 -f" -K
```

v2:
```bash
python nmapai_v2.py -f targets.txt --profile stealth
```

### Step 4: Use New Features

#### Multiple AI Providers

```bash
# OpenAI (default)
python nmapai_v2.py -f targets.txt --ai --ai-provider openai

# Anthropic Claude
export ANTHROPIC_API_KEY="sk-ant-..."
python nmapai_v2.py -f targets.txt --ai --ai-provider anthropic

# Ollama (local, free)
python nmapai_v2.py -f targets.txt --ai --ai-provider ollama -m llama3.1:8b
```

#### Configuration Files

```bash
# Create config from profile
python nmapai_v2.py --list-profiles

# Copy example config
cp nmapai/config/example-config.yaml my-config.yaml

# Edit and use
python nmapai_v2.py -f targets.txt --config my-config.yaml
```

#### Adaptive Scanning

```bash
# v2 can perform intelligent follow-up scans
python nmapai_v2.py -f targets.txt --adaptive --profile standard
```

#### Enrichment Control

```bash
# Disable specific enrichers
python nmapai_v2.py -f targets.txt --no-epss --no-exploitdb

# Use NVD API key for faster rate limits
python nmapai_v2.py -f targets.txt --nvd-api-key "your-key"
```

## Feature Comparison Table

| Feature | v1 | v2 |
|---------|----|----|
| **Core Scanning** | | |
| Nmap integration | ‚úÖ | ‚úÖ |
| Nikto web scanning | ‚úÖ | ‚úÖ |
| DursVuln NSE | ‚úÖ | ‚úÖ |
| Progress tracking | ‚úÖ | ‚úÖ (Enhanced) |
| **AI Analysis** | | |
| OpenAI GPT | ‚úÖ | ‚úÖ |
| Anthropic Claude | ‚ùå | ‚úÖ |
| Ollama (local) | ‚ùå | ‚úÖ |
| Streaming responses | ‚ùå | ‚úÖ |
| **Intelligence** | | |
| NVD enrichment | ‚ùå | ‚úÖ |
| EPSS scoring | ‚ùå | ‚úÖ |
| ExploitDB search | ‚ùå | ‚úÖ |
| Risk prioritization | ‚ùå | ‚úÖ |
| **Reporting** | | |
| JSON output | ‚úÖ | ‚úÖ |
| Markdown report | ‚úÖ | ‚úÖ (Enhanced) |
| HTML dashboard | ‚ùå | ‚úÖ |
| CSV export | ‚úÖ | ‚úÖ |
| **Configuration** | | |
| CLI options | ‚úÖ | ‚úÖ |
| Scan profiles | ‚ùå | ‚úÖ |
| Config files | ‚ùå | ‚úÖ (YAML/JSON) |
| **Architecture** | | |
| Monolithic | ‚úÖ | ‚ùå |
| Plugin system | ‚ùå | ‚úÖ |
| Extensible | ‚ö†Ô∏è | ‚úÖ |

## Output Differences

### v1 Output:
```
out_nmapai_20250112_143022/
‚îú‚îÄ‚îÄ nmap_results.{nmap,gnmap,xml}
‚îú‚îÄ‚îÄ nmap_summary.{csv,json,md}
‚îú‚îÄ‚îÄ dursvuln_summary.md
‚îú‚îÄ‚îÄ nikto/
‚îú‚îÄ‚îÄ ai_analysis.md
‚îî‚îÄ‚îÄ nmap_scan.log
```

### v2 Output:
```
out_nmapai_v2_20250112_143022/
‚îú‚îÄ‚îÄ nmap_results.{nmap,gnmap,xml}
‚îú‚îÄ‚îÄ report.json               ‚≠ê Enhanced
‚îú‚îÄ‚îÄ report.md                 ‚≠ê Enhanced
‚îú‚îÄ‚îÄ dashboard.html            üÜï Interactive
‚îú‚îÄ‚îÄ vulnerabilities.csv       üÜï Enriched
‚îú‚îÄ‚îÄ nikto/
‚îÇ   ‚îú‚îÄ‚îÄ *.html
‚îÇ   ‚îî‚îÄ‚îÄ *.json                üÜï Structured
‚îî‚îÄ‚îÄ nmap_scan.log
```

## API Keys Setup

Both versions use environment variables, but v2 supports more providers:

```bash
# v1 & v2
export OPENAI_API_KEY="sk-..."

# v2 only
export ANTHROPIC_API_KEY="sk-ant-..."
export NVD_API_KEY="your-nvd-key"
export OPENAI_ENDPOINT="https://custom-endpoint.com"
export OLLAMA_ENDPOINT="http://localhost:11434"
```

## Common Migration Issues

### Issue 1: Import Errors

**Error:**
```
ModuleNotFoundError: No module named 'aiohttp'
```

**Solution:**
```bash
pip install -r requirements.txt
```

### Issue 2: Different Output Structure

**Problem:** Scripts expect v1 output format

**Solution:** Use JSON output for parsing:
```python
import json
with open('out_nmapai_v2_*/report.json') as f:
    data = json.load(f)
    vulns = data['vulnerabilities']
```

### Issue 3: AI Provider Change

**Problem:** v1 auto-detected provider, v2 requires explicit flag

**Solution:**
```bash
# v2 requires --ai-provider
python nmapai_v2.py -f targets.txt --ai --ai-provider openai
```

### Issue 4: Enrichment Overhead

**Problem:** v2 scans take longer due to enrichment

**Solution:** Disable enrichers you don't need:
```bash
python nmapai_v2.py -f targets.txt --no-epss --no-exploitdb
```

## Performance Comparison

| Scan Type | v1 Time | v2 Time | v2 Improvement |
|-----------|---------|---------|----------------|
| Basic (no AI) | ~5 min | ~5 min | Same |
| With AI | ~7 min | ~8 min | +NVD/EPSS data |
| Deep scan | ~30 min | ~35 min | +enrichment |
| Quick profile | N/A | ~2 min | üÜï Faster |

v2 is slightly slower due to enrichment, but provides **much more actionable intelligence**.

## Rollback Plan

If you need to rollback to v1:

```bash
# v1 still works alongside v2
python nmapai.py -f targets.txt ...

# Remove v2 if needed
rm -rf nmapai/ nmapai_v2.py
```

## Recommended Approach

1. **Week 1:** Test v2 alongside v1
   ```bash
   # Run both for comparison
   python nmapai.py -f targets.txt -a
   python nmapai_v2.py -f targets.txt --profile standard --ai
   ```

2. **Week 2:** Migrate non-critical scans to v2
   ```bash
   # Use v2 for development scans
   python nmapai_v2.py -f dev_targets.txt --profile quick
   ```

3. **Week 3:** Create custom configs for v2
   ```bash
   cp nmapai/config/example-config.yaml prod-config.yaml
   # Customize...
   python nmapai_v2.py -f targets.txt --config prod-config.yaml
   ```

4. **Week 4:** Full migration to v2
   ```bash
   # Update automation scripts
   alias nmapai='python nmapai_v2.py'
   ```

## Getting Help

- **Documentation:** [README_V2.md](README_V2.md)
- **Quick Start:** [QUICKSTART.md](QUICKSTART.md)
- **Issues:** https://github.com/Masriyan/NmapAI-gility/issues

## Summary

**Should you migrate?**

‚úÖ **Yes, if you want:**
- Multiple AI providers (Claude, Ollama)
- Vulnerability intelligence (NVD, EPSS, ExploitDB)
- Risk prioritization
- Interactive HTML dashboard
- Scan profiles
- Extensibility via plugins

‚è∏Ô∏è **Maybe wait if you need:**
- 100% stable production environment
- Minimal dependencies
- Fastest possible scans

**Bottom line:** v2 offers **significantly more value** with minimal additional complexity. The enhanced intelligence and prioritization alone make it worth migrating.
